name: Run on BrowserStack

on: 
  workflow_dispatch:
    inputs:
      build-name: 
        description: 'Name of the buid'     
        required: true
        default: 'daily'

jobs:
  browser-stack:
    runs-on: ubuntu-latest

    environment: sandbox

    steps:

    - name: Info    
      env:
        BROWSERSTACK_USERNAME: ${{ secrets.BROWSERSTACK_USERNAME }}
      run: |
        echo "User name: ${{ env.BROWSERSTACK_USERNAME }}"
        echo "Build name: ${{ github.event.inputs.build-name }}"

    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Node 16
      uses: actions/setup-node@v3
      with:
        node-version: 16

    - name: 'BrowserStack Env Setup'
      uses: 'browserstack/github-actions/setup-env@master'          
      env:
        BROWSERSTACK_USERNAME: ${{ secrets.BROWSERSTACK_USERNAME }}
        BROWSERSTACK_ACCESS_KEY: ${{ secrets.BROWSERSTACK_ACCESS_KEY }}
      with:
        username:  ${{ env.BROWSERSTACK_USERNAME }}
        access-key: ${{ env.BROWSERSTACK_ACCESS_KEY }}
        build-name: ${{ github.event.inputs.build-name }}

    - name: BrowserStack CLI Install
      run: npm install browserstack-cypress-cli

    - name: Npm Install
      run: npm install

    - name: Start local server
      run: npm run start

    - name: Run Test
      run: browserstack-cypress run